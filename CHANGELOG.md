# 更新日志

## [1.1.0] - 2026-01-14

### 新增功能

#### 🔍 增强的调试日志系统

为了更好地调试搜索准确性，添加了详细的父Hash追踪日志功能。

**主要改进：**

1. **最终父Hash列表显示**
   - 在传给LLM之前，日志会显示所有最终选定的父Hash
   - 格式：`最终选定的父Hash列表 (共 N 个)`
   - 每个Hash都会单独列出，便于追踪

2. **DEBUG模式下的完整内容记录**
   - 启用DEBUG日志级别时，会记录每个父Hash对应的完整内容
   - 包括：章节标题、内容长度、完整文本
   - 分隔线清晰，易于查看和分析

3. **LLM输入上下文预览**
   - 显示传给LLM的最终上下文预览（前500字符）
   - 记录上下文总长度和父节点数量
   - 便于验证检索结果的质量

4. **增强的中间步骤日志**
   - 精排模式：显示每个文档的父Hash，标记是否被选入
   - 直取模式：显示选中文档的父Hash
   - 所有Hash显示前12位，便于识别

**配置方式：**

在 `.env` 文件中设置：

```bash
# 标准模式（默认）
LOG_LEVEL=INFO

# 调试模式（显示详细内容）
LOG_LEVEL=DEBUG
```

**日志示例：**

INFO级别（默认）：
```
[2026-01-14 10:30:15] - INFO - 最终选定的父Hash列表 (共 3 个):
  [1] Hash: a1b2c3d4e5f6g7h8
  [2] Hash: i9j0k1l2m3n4o5p6
  [3] Hash: q7r8s9t0u1v2w3x4
[2026-01-14 10:30:15] - INFO - 上下文总长度: 3456 字符
[2026-01-14 10:30:15] - INFO - 传给LLM的父节点数量: 3
```

DEBUG级别（详细）：
```
[2026-01-14 10:30:15] - DEBUG - ============================================================
[2026-01-14 10:30:15] - DEBUG - 【Debug模式】父Hash对应的完整内容:
[2026-01-14 10:30:15] - DEBUG - ============================================================
[2026-01-14 10:30:15] - DEBUG -
[父节点 1]
  Hash: a1b2c3d4e5f6g7h8
  标题: # 数据存储技术
  内容长度: 1234 字符
  完整内容:
------------------------------------------------------------
# 数据存储技术
数据存储技术是现代信息系统的核心组成部分...
[完整章节内容]
------------------------------------------------------------
```

**使用场景：**

1. **调试搜索准确性**
   - 检查检索到的章节是否与问题相关
   - 验证父Hash映射是否正确

2. **优化检索参数**
   - 根据实际检索到的内容调整阈值
   - 分析重排效果

3. **问题排查**
   - 当回答不准确时，查看具体检索到了哪些内容
   - 验证向量检索和重排的效果

**文件修改：**

- `main.py`: 添加详细的父Hash日志记录逻辑
- `env.example`: 添加LOG_LEVEL配置说明
- `README.md`: 添加完整的调试模式使用指南
- `CHANGELOG.md`: 记录此次更新

### 改进

- 精排模式日志更清晰，显示哪些文档被选入
- 直取模式日志更详细，显示选中文档的Hash
- Hash显示从8位增加到12位，更容易区分

### 文档

- 更新README，添加"调试模式"章节
- 更新环境变量配置说明
- 添加详细的日志示例

---

## [1.0.0] - 2026-01-14

### 初始版本

- ✨ 实现核心RAG功能
- 🎯 向量检索和语义重排
- 📝 完整的项目文档
- 🎨 现代化Web界面
- 🔧 灵活的配置管理
- 📊 详细的日志系统
